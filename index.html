<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Poll Sanity Test</title>
<style>
body{font-family:sans-serif;padding:20px}
.bar{height:12px;background:#ddd;margin:4px 0;border-radius:6px;overflow:hidden}
.bar div{height:100%;background:#a51c30}
</style>
</head>
<body>

<h2>Poll Sanity Test</h2>
<div id="status">Loading…</div>
<h3 id="question"></h3>
<div id="results"></div>

<script>
const CSV_URL =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vTKx-RLgpSi8LAyWnwASyl3PH5tbZud2j_uaz_zo8nFq5e7QfvOM6NuGNXpQRjdfKSkv_V2STv-qnbt/pub?output=csv";

fetch(CSV_URL)
  .then(r=>r.text())
  .then(text=>{
    status.textContent="Fetched CSV successfully.";
    const rows = text.trim().split("\n").map(r=>r.split(","));
    question.textContent = "Question: " + rows[0][1];

    const counts = {};
    rows.slice(1).forEach(r=>{
      const v=r[1]?.trim();
      if(v) counts[v]=(counts[v]||0)+1;
    });

    const total = Object.values(counts).reduce((a,b)=>a+b,0);
    for(const k in counts){
      const pct=Math.round(counts[k]/total*100);
      results.innerHTML+=`
        <div>${k} — ${counts[k]} votes (${pct}%)</div>
        <div class="bar"><div style="width:${pct}%"></div></div>
      `;
    }
  })
  .catch(e=>{
    status.textContent="ERROR: "+e;
  });
</script>

</body>
</html>
