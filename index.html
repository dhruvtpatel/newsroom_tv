<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Crimson Newsroom</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
:root{
  --crimson:#a51c30;
  --dark:#111;
  --muted:#777;
  --line:#e6e6e6;
  --card:#f7f7f7;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Georgia,serif;
  background:#fff;
  height:100vh;
  overflow:hidden;
}
.container{
  display:grid;
  grid-template-columns:1.3fr 1.1fr 1fr;
  height:100%;
  padding:10px;
  gap:10px;
}

/* Shared */
.section-title{
  font-size:10px;
  letter-spacing:1.2px;
  text-transform:uppercase;
  color:var(--muted);
  margin-bottom:2px;
}
.card{
  background:var(--card);
  border-radius:10px;
  padding:8px;
}

/* LEFT */
.left{
  display:flex;
  flex-direction:column;
  gap:6px;
}
.logo{color:var(--crimson);font-weight:bold;font-size:16px}
.welcome{font-size:12px}
.time{font-size:68px;color:var(--crimson);line-height:.95}
.date{font-size:14px;color:var(--muted)}

.spotify{
  flex:1;
  border-radius:12px;
  overflow:hidden;
  box-shadow:0 4px 10px rgba(0,0,0,.08);
}
.spotify iframe{
  width:100%;
  height:100%;
  border:0;
}

/* MIDDLE */
.middle{
  display:flex;
  flex-direction:column;
  gap:8px;
}
.status{
  display:flex;
  flex-direction:column;
  gap:6px;
}
.proofer-name{
  font-size:20px;
  color:var(--crimson);
  font-weight:bold;
}
.countdown{
  font-size:24px;
  font-weight:bold;
}
.feed{
  flex:1;
  border-radius:10px;
  overflow:hidden;
  border:1px solid var(--line);
}
.feed iframe{
  width:100%;
  height:100%;
  border:0;
}

/* RIGHT */
.right{
  display:flex;
  flex-direction:column;
  gap:8px;
}
.scoops{
  text-align:center;
}
.scoops .num{
  font-size:44px;
  font-weight:bold;
  color:var(--crimson);
}
.rewards{
  margin-top:4px;
  font-size:11px;
  color:#333;
}
.rewards div{
  padding:2px 0;
  border-top:1px solid var(--line);
}
.rewards div:first-child{border-top:none}

/* POLL */
.poll-box{
  flex:1;
  display:flex;
  flex-direction:column;
  gap:6px;
}
.poll-title{
  font-size:13px;
  font-weight:bold;
  text-align:center;
}
.poll-results{width:100%;}
.poll-row{font-size:11px;margin-top:4px;}
.bar{
  width:100%;
  height:8px;
  background:#ddd;
  border-radius:6px;
  overflow:hidden;
  margin:2px 0;
}
.bar div{
  height:100%;
  background:var(--crimson);
}
</style>
</head>
<body>
<div class="container">

<!-- LEFT -->
<div class="left">
  <div class="logo">THE HARVARD CRIMSON</div>
  <div class="welcome">Welcome back to 14P!</div>
  <div class="time" id="time"></div>
  <div class="date" id="date"></div>

  <div class="spotify">
    <iframe 
      src="https://open.spotify.com/embed/playlist/6ZTkxn7qyBtvLqWBmQeaUn"
      allow="autoplay; encrypted-media">
    </iframe>
  </div>
</div>

<!-- MIDDLE -->
<div class="middle">
  <div class="card status">
    <div class="section-title">Proofer of the Day</div>
    <div class="proofer-name" id="proofer"></div>

    <div class="section-title">Time Until Four Fig (12:59 AM)</div>
    <div class="countdown" id="countdown"></div>
  </div>

  <div>
    <div class="section-title">Latest from the Crimson</div>
    <div class="feed">
      <script src="https://cdn.lightwidget.com/widgets/lightwidget.js"></script>
      <iframe src="https://cdn.lightwidget.com/widgets/d96bb35398d75ecf8aa4496966aa2bea.html"></iframe>
    </div>
  </div>
</div>

<!-- RIGHT -->
<div class="right">

  <div class="card scoops">
    <div class="section-title">Scoops This Month</div>
    <div class="num">7</div>
    <div class="rewards">
      <div>10 scoops → Chipotle</div>
      <div>15 scoops → Crimson merch</div>
      <div>20 scoops → Staff dinner</div>
    </div>
  </div>

  <div class="card poll-box">
    <div class="section-title">Poll of the Week</div>
    <div id="pollQuestion" class="poll-title"></div>
    <div style="font-size:11px;color:var(--muted);text-align:center">
    </div>
    <div id="pollResults" class="poll-results"></div>
  </div>

</div>
</div>

<script>
function updateTime(){
  const n=new Date();
  let h=n.getHours(),m=n.getMinutes().toString().padStart(2,"0");
  h=h%12||12;
  time.textContent=`${h}:${m}`;
  date.textContent=n.toLocaleDateString(undefined,{weekday:"short",month:"short",day:"numeric"});
}
setInterval(updateTime,1000);updateTime();

const proofers=["LP Chavez","Dhruv Patel","Maya Patel","Jordan Smith"];
proofer.textContent=proofers[new Date().getDate()%proofers.length];

function updateCountdown(){
  const now=new Date(),t=new Date();
  t.setHours(0,59,0,0);
  if(now>t)t.setDate(t.getDate()+1);
  const d=t-now;
  const h=Math.floor(d/3600000),
        m=Math.floor(d%3600000/60000),
        s=Math.floor(d%60000/1000);
  countdown.textContent=
    `${String(h).padStart(2,"0")}:${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`;
}
setInterval(updateCountdown,1000);updateCountdown();

/* POLL FROM GOOGLE SHEET */
const SHEET_CSV =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vTKx-RLgpSi8LAyWnwASyl3PH5tbZud2j_uaz_zo8nFq5e7QfvOM6NuGNXpQRjdfKSkv_V2STv-qnbt/pub?output=csv";

async function loadPoll(){
  const txt = await fetch(SHEET_URL).then(r=>r.text());
  const json = JSON.parse(txt.substring(txt.indexOf("{"),txt.lastIndexOf("}")+1));
  const rows = json.table.rows;

  let question = rows[0]?.c[1]?.v || "";
  let choices = [];
  let votes = [];
  let inVotes = false;

  for(let i=1;i<rows.length;i++){
    const a = rows[i].c[0]?.v || "";
    const b = rows[i].c[1]?.v || "";

    if(!b) continue;

    if(!inVotes && !a){
      // still in choices section
      choices.push(b);
    } else {
      // once we hit first timestamp, everything after is votes
      inVotes = true;
      votes.push(b);
    }
  }

  const counts = {};
  choices.forEach(c => counts[c] = 0);
  votes.forEach(v => { if(counts[v] != null) counts[v]++; });

  const total = votes.length || 1;
  pollQuestion.textContent = question;
  pollResults.innerHTML = "";

  choices.forEach(c=>{
    const pct = Math.round(counts[c]/total*100);
    pollResults.innerHTML += `
      <div class="poll-row">${c} — ${pct}% (${counts[c]})</div>
      <div class="bar"><div style="width:${pct}%"></div></div>
    `;
  });
}


loadPoll();
setInterval(loadPoll,5000);
</script>
</body>
</html>